<!DOCTYPE html> // stable version
<html lang="ru">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>clicker123</title>
   <script src="https://telegram.org/js/telegram-web-app.js"></script>
   <style>
      :root {
         --tg-theme-bg-color: #ffffff;
         --tg-theme-text-color: #000000;
         --tg-theme-hint-color: #999999;
         --tg-theme-link-color: #007bff;
         --tg-theme-button-color: #007bff;
         --tg-theme-button-text-color: #ffffff;
      }

      body {
         margin: 0;
         font-family: Arial, sans-serif;
         color: var(--tg-theme-text-color);
         background: var(--tg-theme-bg-color);
         display: flex;
         flex-direction: column;
         align-items: center;
         min-height: 100vh;
         font-size: 18px;
      }

      .content {
         flex: 1;
         padding: 20px;
         width: 100%;
         max-width: 600px;
         box-sizing: border-box;
         overflow-y: auto;
      }

      .tabs {
         display: flex;
         position: fixed;
         bottom: 0;
         width: 100%;
         max-width: 600px;
         background: var(--tg-theme-bg-color);
         box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
      }

      .tab {
         flex: 1;
         padding: 15px;
         text-align: center;
         cursor: pointer;
         border-top: 2px solid transparent;
         transition: all 0.3s;
      }

      .tab.active {
         border-top: 2px solid var(--tg-theme-button-color);
         background: #f5f5f5;
      }

      .image-button {
         width: 200px;
         height: 200px;
         border: none;
         background-image: url('https://gas-kvas.com/grafic/uploads/posts/2024-01/gas-kvas-com-p-znachok-bitkoina-na-prozrachnom-fone-15.png');
         background-size: cover;
         cursor: pointer;
         transition: transform 0.2s;
      }

      .image-button:active {
         transform: scale(0.95);
      }

      .button {
         background: var(--tg-theme-button-color);
         color: var(--tg-theme-button-text-color);
         border: none;
         padding: 10px 20px;
         border-radius: 5px;
         font-size: 16px;
         cursor: pointer;
         margin: 10px 0;
      }

      .energy-bar {
         width: 100%;
         height: 20px;
         background: #ddd;
         border-radius: 10px;
         overflow: hidden;
         margin: 10px 0;
      }

      .energy-fill {
         height: 100%;
         background: var(--tg-theme-button-color);
         transition: width 0.3s;
      }

      #balance, #energy {
         font-size: 24px;
         font-weight: bold;
         margin: 10px 0;
      }

      .boost-item {
         display: flex;
         justify-content: space-between;
         padding: 10px;
         border-bottom: 1px solid #eee;
      }
   </style>
</head>
<body>
   <div class="content" id="content1">
      <h1 id="balance">0</h1>
      <div id="energy">Energy: 100/100</div>
      <div class="energy-bar"><div class="energy-fill" id="energy-fill" style="width: 100%"></div></div>
      <button id="click" class="image-button"></button>
   </div>
   <div class="content" id="content2" style="display:none;">
      <h2>Boosts</h2>
      <div id="boosts">
         <div class="boost-item">
            <span>Click Power +1</span>
            <button class="button boost-click-power">Buy (100)</button>
         </div>
         <div class="boost-item">
            <span>Auto Clicker</span>
            <button class="button boost-auto-clicker">Buy (500)</button>
         </div>
      </div>
   </div>
   <div class="content" id="content3" style="display:none;">
      <h2>Friends</h2>
      <p>Invite friends to earn bonuses!</p>
      <button class="button invite-friend">Invite Friend</button>
   </div>

   <div class="tabs">
      <div class="tab active" data-tab="1">Click</div>
      <div class="tab" data-tab="2">Boost</div>
      <div class="tab" data-tab="3">Friends</div>
   </div>

   <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-app.js";
      import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-database.js";
      import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-auth.js";

      const firebaseConfig = {
         apiKey: "AIzaSyBhLISxR41ZYKyyffiY08c_YtqYQdu85pk",
         authDomain: "test-b5ec3.firebaseapp.com",
         databaseURL: "https://test-b5ec3-default-rtdb.firebaseio.com",
         projectId: "test-b5ec3",
         storageBucket: "test-b5ec3.appspot.com",
         messagingSenderId: "489032935342",
         appId: "1:489032935342:web:922e8c518ad0ff6b6eca3f",
         measurementId: "G-YNQM9CV4P3"
      };

      const app = initializeApp(firebaseConfig);
      const db = getDatabase(app);
      const auth = getAuth(app);
      const tg = window.Telegram.WebApp;
      tg.expand();
      console.log("Telegram Web App initialized"); // log

      let balance = 0;
      let energy = 100;
      let maxEnergy = 100;
      let clickPower = 1;
      let autoClicker = 0;
      let userId = null;

      // Extract pass1 from URL
      const urlParams = new URLSearchParams(window.location.search);
      const pass1 = urlParams.get("pass1");
      console.log("Extracted pass1:", pass1); // log

      // Get Telegram user ID
      userId = tg.initDataUnsafe.user?.id;
      console.log("User ID:", userId); // log
      if (!userId || !pass1) {
         console.log("Missing userId or pass1"); // log
         alert("Error: Unable to get Telegram user ID or password");
         tg.close();
      } else {
         // Authenticate with Firebase
         const email = userId + "@example.com";
         console.log("Attempting to authenticate with email:", email); // log
         signInWithEmailAndPassword(auth, email, pass1)
            .then((userCredential) => {
               console.log("Authenticated user:", userCredential.user.uid); // log
               initializeUserData();
            })
            .catch((error) => {
               console.error("Authentication error:", error); // log
               alert("Authentication failed: " + error.message);
               tg.close();
            });
      }

      // Initialize user data after authentication
      function initializeUserData() {
         console.log("Initializing user data for userId:", userId); // log
         const userRef = ref(db, "users/" + userId);
         onValue(userRef, (snapshot) => {
            if (snapshot.exists()) {
               const data = snapshot.val();
               balance = data.balance || 0;
               energy = data.energy || maxEnergy;
               clickPower = data.clickPower || 1;
               autoClicker = data.autoClicker || 0;
               console.log("Loaded user data:", data); // log
               updateUI();
            } else {
               console.log("No user data found, initializing new data"); // log
               saveData();
               updateUI();
            }
         }, (error) => {
            console.error("Firebase error:", error); // log
            alert("Failed to load user data: " + error.message);
         });
      }

      // Click handler
      document.getElementById("click").addEventListener("click", () => {
         console.log("Click button pressed, current energy:", energy); // log
         if (energy >= 1) {
            energy -= 1;
            balance += clickPower;
            console.log("New balance:", balance, "New energy:", energy); // log
            saveData();
            updateUI();
         } else {
            console.log("Not enough energy"); // log
            alert("Not enough energy!");
         }
      });

      // Energy regeneration
      setInterval(() => {
         if (energy < maxEnergy) {
            energy = Math.min(energy + 1, maxEnergy);
            console.log("Energy regenerated to:", energy); // log
            updateUI();
         }
      }, 1000);

      // Auto clicker
      setInterval(() => {
         if (autoClicker > 0) {
            balance += autoClicker;
            console.log("Auto clicker added:", autoClicker, "New balance:", balance); // log
            saveData();
            updateUI();
         }
      }, 1000);

      // Save data to Firebase
      function saveData() {
         if (!userId) {
            console.log("No userId, skipping save"); // log
            return;
         }
         console.log("Saving data for userId:", userId); // log
         set(ref(db, "users/" + userId), {
            balance,
            energy,
            clickPower,
            autoClicker
         }).catch((error) => {
            console.error("Error saving data:", error); // log
         });
      }

      // Update UI
      function updateUI() {
         console.log("Updating UI, balance:", balance, "energy:", energy); // log
         document.getElementById("balance").innerText = Math.floor(balance);
         document.getElementById("energy").innerText = "Energy: " + Math.floor(energy) + "/" + maxEnergy;
         document.getElementById("energy-fill").style.width = (energy / maxEnergy) * 100 + "%";
      }

      // Buy boost
      function buyBoost(type, cost) {
         console.log("Attempting to buy boost:", type, "Cost:", cost); // log
         if (balance >= cost) {
            balance -= cost;
            if (type === "clickPower") {
               clickPower += 1;
               console.log("Increased clickPower to:", clickPower); // log
            } else if (type === "autoClicker") {
               autoClicker += 1;
               console.log("Increased autoClicker to:", autoClicker); // log
            }
            saveData();
            updateUI();
         } else {
            console.log("Not enough coins for boost"); // log
            alert("Not enough coins!");
         }
      }

      // Invite friend
      function inviteFriend() {
         console.log("Generating invite link for userId:", userId); // log
         const inviteLink = "https://t.me/your_bot?start=" + userId;
         const shareUrl = "https://t.me/share/url?url=" + encodeURIComponent(inviteLink) + "&text=Join%20my%20game!";
         console.log("Opening Telegram share URL:", shareUrl); // log
         tg.openTelegramLink(shareUrl);
      }

      // Tab navigation
      function showTab(tabIndex) {
         console.log("Switching to tab:", tabIndex); // log
         document.querySelectorAll(".content").forEach((content, index) => {
            content.style.display = index === tabIndex - 1 ? "block" : "none";
         });
         document.querySelectorAll(".tab").forEach((tab, index) => {
            tab.classList.toggle("active", index === tabIndex - 1);
         });
      }

      // Bind tab events
      document.querySelectorAll(".tab").forEach(tab => {
         tab.addEventListener("click", () => {
            const tabIndex = parseInt(tab.getAttribute("data-tab"));
            console.log("Tab clicked, index:", tabIndex); // log
            showTab(tabIndex);
         });
      });

      // Bind boost buttons
      document.querySelector(".boost-click-power").addEventListener("click", () => {
         console.log("Boost click power button clicked"); // log
         buyBoost("clickPower", 100);
      });
      document.querySelector(".boost-auto-clicker").addEventListener("click", () => {
         console.log("Boost auto clicker button clicked"); // log
         buyBoost("autoClicker", 500);
      });

      // Bind invite button
      document.querySelector(".invite-friend").addEventListener("click", () => {
         console.log("Invite friend button clicked"); // log
         inviteFriend();
      });
   </script>
</body>
</html>
