<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>clicker123</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéÆ</text></svg>">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --tg-theme-bg-color: #ffffff;
            --tg-theme-text-color: #000000;
            --tg-theme-hint-color: #999999;
            --tg-theme-link-color: #007bff;
            --tg-theme-button-color: #007bff;
            --tg-theme-button-text-color: #ffffff;
        }

        body {
            margin: 0;
            font-family: Arial, sans-serif;
            color: var(--tg-theme-text-color);
            background: var(--tg-theme-bg-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            font-size: 18px;
        }

        .content {
            flex: 1;
            padding: 20px;
            width: 100%;
            max-width: 600px;
            box-sizing: border-box;
            overflow-y: auto;
        }

        .tabs {
            display: flex;
            position: fixed;
            bottom: 0;
            width: 100%;
            max-width: 600px;
            background: var(--tg-theme-bg-color);
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
        }

        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            border-top: 2px solid transparent;
            transition: all 0.3s;
        }

        .tab.active {
            border-top: 2px solid var(--tg-theme-button-color);
            background: #f5f5f5;
        }

        .image-button {
            width: 200px;
            height: 200px;
            border: none;
            background-image: url('https://gas-kvas.com/grafic/uploads/posts/2024-01/gas-kvas-com-p-znachok-bitkoina-na-prozrachnom-fone-15.png');
            background-size: cover;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .image-button:active {
            transform: scale(0.95);
        }

        .button {
            background: var(--tg-theme-button-color);
            color: var(--tg-theme-button-text-color);
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 0;
        }

        .energy-bar {
            width: 100%;
            height: 20px;
            background: #ddd;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .energy-fill {
            height: 100%;
            background: var(--tg-theme-button-color);
            transition: width 0.3s;
        }

        #balance, #energy {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
        }

        .boost-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
    </style>
</head>
<body>
    <div class="content" id="content1">
        <h1 id="balance">0</h1>
        <div id="energy">Energy: 100/100</div>
        <div class="energy-bar"><div class="energy-fill" id="energy-fill" style="width: 100%"></div></div>
        <button id="click" class="image-button"></button>
    </div>
    <div class="content" id="content2" style="display:none;">
        <h2>Boosts</h2>
        <div id="boosts">
            <div class="boost-item">
                <span>Click Power +1 (Level <span class="level-multiply-per-click">1</span>)</span>
                <button class="button boost-multiply-per-click">Buy (<span class="cost-multiply-per-click">100</span>)</button>
            </div>
            <div class="boost-item">
                <span>Energy Limit +100 (Level <span class="level-energy-limit">1</span>)</span>
                <button class="button boost-energy-limit">Buy (<span class="cost-energy-limit">200</span>)</button>
            </div>
            <div class="boost-item">
                <span>Faster Energy Recharge (Level <span class="level-recharge-energy">1</span>)</span>
                <button class="button boost-recharge-energy">Buy (<span class="cost-recharge-energy">150</span>)</button>
            </div>
            <div class="boost-item">
                <span>Passive Income Card 1 (Level <span class="level-passive-card1">0</span>)</span>
                <button class="button boost-passive-card1">Buy (<span class="cost-passive-card1">300</span>)</button>
            </div>
            <div class="boost-item">
                <span>Passive Income Card 2 (Level <span class="level-passive-card2">0</span>)</span>
                <button class="button boost-passive-card2">Buy (<span class="cost-passive-card2">500</span>)</button>
            </div>
            <div class="boost-item">
                <span>Passive Income Card 3 (Level <span class="level-passive-card3">0</span>)</span>
                <button class="button boost-passive-card3">Buy (<span class="cost-passive-card3">1000</span>)</button>
            </div>
        </div>
    </div>
    <div class="content" id="content3" style="display:none;">
        <h2>Friends</h2>
        <p>Invite friends to earn bonuses!</p>
        <button class="button invite-friend">Invite Friend</button>
    </div>

    <div class="tabs">
        <div class="tab active" data-tab="1">Click</div>
        <div class="tab" data-tab="2">Boost</div>
        <div class="tab" data-tab="3">Friends</div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
        import { getDatabase, ref, set, update, onValue } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js";
        import { getAuth, signInWithEmailAndPassword, setPersistence, inMemoryPersistence } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBhLISxR41ZYKyyffiY08c_YtqYQdu85pk",
            authDomain: "test-b5ec3.firebaseapp.com",
            databaseURL: "https://test-b5ec3-default-rtdb.firebaseio.com",
            projectId: "test-b5ec3",
            storageBucket: "test-b5ec3.appspot.com",
            messagingSenderId: "489032935342",
            appId: "1:489032935342:web:922e8c518ad0ff6b6eca3f",
            measurementId: "G-YNQM9CV4P3"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);
        setPersistence(auth, inMemoryPersistence);
        const tg = window.Telegram.WebApp;
        tg.expand();

        let userId = tg.initDataUnsafe.user && tg.initDataUnsafe.user.id ? tg.initDataUnsafe.user.id : null;
        let balance = parseFloat(localStorage.getItem(balance_${userId}));
        let serverBalance = 0;
        let clickCounter = 0;
        let energy = 100;
        let maxEnergy = 100;
        let rechargeRate = 1;
        let clickPower = 1;
        let passiveIncome = { card1: 0, card2: 0, card3: 0 };
        let lastClickTime = 0;
        let lastEnergyUpdate = 0;
        let firstClickTime = 0;
        let recentClicks = [];
        const MIN_CLICK_INTERVAL = 100;
        const ENERGY_UPDATE_INTERVAL = 1000;
        const MAX_CLICKS_PER_SECOND = 10;
        const CLICK_SAVE_THRESHOLD = 200;
        const PASSIVE_INCOME_MAX_HOURS = 6;

        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±—É—Å—Ç–æ–≤
        const boostConfig = {
            multiply_per_click: {
                cost: level => Math.floor(100 * level * level),
                effect: level => level
            },
            energy_limit: {
                cost: level => Math.floor(200 * level * level),
                effect: level => level * 100
            },
            recharge_energy: {
                cost: level => Math.floor(150 * level * level),
                effect: level => level
            },
            passive_income: {
                card1: {
                    cost: level => Math.floor(300 * level * level),
                    income: 1
                },
                card2: {
                    cost: level => Math.floor(500 * level * level),
                    income: 2
                },
                card3: {
                    cost: level => Math.floor(1000 * level * level),
                    income: 5
                }
            }
        };

        // –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ pass1
        const urlParams = new URLSearchParams(window.location.search);
        const pass1 = urlParams.get("pass1");

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ userId –∏ pass1
        function initializeAppLogic() {
            if (!userId || !pass1) {
                alert("Error: Unable to get Telegram user ID or password");
                tg.close();
                return false;
            }
            return true;
        }

        // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        if (initializeAppLogic()) {
            const email = userId + "@example.com";
            signInWithEmailAndPassword(auth, email, pass1)
                .then(userCredential => {
                    console.log("Auth successful for user: " + userId);
                    initializeUserData();
                    logLogin();
                })
                .catch(error => {
                    console.error("Authentication failed: " + error.message);
                    alert("Authentication failed: " + error.message);
                    tg.close();
                });
        }

        // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ö–æ–¥–∞
        function logLogin() {
            const now = Date.now();
            const loginData = 1;
            if (typeof loginData !== 'number' || loginData !== 1) {
                console.error("Invalid login data: ", loginData);
                return;
            }
            set(ref(db, users/${userId}/login_history/${now}), loginData)
                .then(() => {
                    console.log(Login recorded: t=${now});
                })
                .catch(error => {
                    console.error("Error logging login: ", error.message);
                    alert("Failed to record login: " + error.message);
                });
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
        async function initializeUserData() {
            const userRef = ref(db, users/${userId});
            onValue(userRef, async snapshot => {
                if (snapshot.exists()) {
                    const data = snapshot.val();
                    serverBalance = data.server_balance || 0;
                    clickCounter = serverBalance;
                    energy = Math.floor(data.energy || maxEnergy);
                    maxEnergy = Math.floor(data.max_energy || 100);
                    rechargeRate = data.recharge_rate || 1;
                    clickPower = data.boosts && data.boosts.multiply_per_click ? Math.max(1, Object.keys(data.boosts.multiply_per_click).length) : 1;
                    passiveIncome.card1 = data.boosts && data.boosts.passive_income && data.boosts.passive_income.card1 ? Object.keys(data.boosts.passive_income.card1).length : 0;
                    passiveIncome.card2 = data.boosts && data.boosts.passive_income && data.boosts.passive_income.card2 ? Object.keys(data.boosts.passive_income.card2).length : 0;
                    passiveIncome.card3 = data.boosts && data.boosts.passive_income && data.boosts.passive_income.card3 ? Object.keys(data.boosts.passive_income.card3).length : 0;
                    if (data.click_balance_history) {
                        const firstKey = Object.keys(data.click_balance_history)[0];
                        firstClickTime = parseInt(firstKey) || 0;
                    }
                    balance = await calculateRealBalance();
                    localStorage.setItem(balance_${userId}, balance);
                    console.log(Firebase init: serverBalance=${serverBalance}, balance=${balance});
                    updateUI();
                } else {
                    console.log("No user data, initializing new data");
                    saveData();
                    updateUI();
                }
            }, { onlyOnce: true });
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–æ–≤
        document.getElementById("click").addEventListener("click", function() {
            const now = Date.now();
            if (now - lastClickTime < MIN_CLICK_INTERVAL) {
                console.log("Click blocked: too frequent");
                return;
            }
            recentClicks = recentClicks.filter(t => now - t < 1000);
            if (recentClicks.length >= MAX_CLICKS_PER_SECOND) {
                console.error(Too many clicks: ${recentClicks.length});
                alert("Too many clicks. Please slow down.");
                return;
            }
            recentClicks.push(now);
            lastClickTime = now;
            if (energy >= 1) {
                energy -= 1;
                clickCounter += clickPower;
                serverBalance += clickPower;
                balance += clickPower;
                console.log(Click: clickCounter=${clickCounter}, serverBalance=${serverBalance}, balance=${balance});
                if (clickCounter % CLICK_SAVE_THRESHOLD === 0) {
                    saveClickHistory(now);
                }
                updateUI();
                saveData();
            } else {
                console.log(Not enough energy: ${energy});
                alert("Not enough energy!");
            }
        });

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –∫–ª–∏–∫–æ–≤
        function saveClickHistory(timestamp) {
            if (!timestamp || !Number.isInteger(timestamp) || !Number.isInteger(clickCounter) || clickCounter < 0) {
                console.error(Invalid click history data: t=${timestamp}, clickCounter=${clickCounter});
                return;
            }
            set(ref(db, users/${userId}/click_balance_history/${timestamp}), clickCounter)
                .then(() => {
                    console.log(Click history saved: t=${timestamp}, clickCounter=${clickCounter});
                })
                .catch(error => {
                    console.error("Error saving click history: ", error.message);
                    alert("Failed to save click history: " + error.message);
                });
        }

        // –†–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–Ω–µ—Ä–≥–∏–∏
        setInterval(() => {
            const now = Date.now();
            if (now - lastEnergyUpdate < ENERGY_UPDATE_INTERVAL) return;
            if (energy < maxEnergy) {
                const increase = Math.floor(Math.min(rechargeRate, maxEnergy - energy));
                energy += increase;
                lastEnergyUpdate = now;
                console.log(Energy regen: energy=${energy}, increase=${increase});
                saveData();
            }
        }, ENERGY_UPDATE_INTERVAL);

        // –ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥
        setInterval(() => {
            const totalPassive = passiveIncome.card1 * boostConfig.passive_income.card1.income +
                                passiveIncome.card2 * boostConfig.passive_income.card2.income +
                                passiveIncome.card3 * boostConfig.passive_income.card3.income;
            if (totalPassive > 0) {
                balance += totalPassive;
                localStorage.setItem(balance_${userId}, balance);
                console.log(Passive income: balance=${balance}, totalPassive=${totalPassive});
                updateUI();
            }
        }, 1000);

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        async function saveData() {
            if (!userId) return;
            try {
                const data = {
                    server_balance: serverBalance,
                    energy: energy,
                    max_energy: maxEnergy,
                    recharge_rate: rechargeRate,
                    boosts: {
                        multiply_per_click: buildBoostLevels("multiply_per_click"),
                        energy_limit: buildBoostLevels("energy_limit"),
                        recharge_energy: buildBoostLevels("recharge_energy"),
                        passive_income: {
                            card1: buildBoostLevels("passive_income/card1"),
                            card2: buildBoostLevels("passive_income/card2"),
                            card3: buildBoostLevels("passive_income/card3")
                        }
                    }
                };
                if (!Number.isInteger(data.server_balance) || data.server_balance < 0 || !Number.isInteger(data.energy) || !Number.isInteger(data.max_energy)) {
                    console.error("Invalid save data: ", data);
                    return;
                }
                await update(ref(db, users/${userId}), data);
                console.log(Data saved: serverBalance=${serverBalance}, energy=${energy});
            } catch (error) {
                console.error("Error saving data: ", error.message);
                alert("Failed to save data: " + error.message);
            }
        }

        // –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±—É—Å—Ç–æ–≤
        function buildBoostLevels(path) {
            const levels = {};
            let count, firstTime = firstClickTime || Date.now();
            if (path === "multiply_per_click") count = clickPower;
            else if (path === "energy_limit") count = maxEnergy / 100;
            else if (path === "recharge_energy") count = rechargeRate;
            else if (path === "passive_income/card1") count = passiveIncome.card1;
            else if (path === "passive_income/card2") count = passiveIncome.card2;
            else if (path === "passive_income/card3") count = passiveIncome.card3;
            else count = 0;

            for (let i = 1; i <= count; i++) {
                levels[i] = i === 1 ? firstTime : firstTime + (3600000 * i);
            }
            return levels;
        }

        // –†–∞—Å—á–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞
       // –†–∞—Å—á–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞
        async function calculateRealBalance() {
            try {
                const userRef = ref(db, users/${userId});
                const snapshot = await new Promise(resolve => onValue(userRef, resolve, { onlyOnce: true }));
                if (!snapshot.exists()) {
                    console.error("No user data for balance calculation");
                    return 0;
                }
                const data = snapshot.val();

                // 1. –°—á–µ—Ç—á–∏–∫ –∫–ª–∏–∫–æ–≤
                let clickBalance = 0;
                if (data.click_balance_history) {
                    const lastKey = Object.keys(data.click_balance_history).sort().pop();
                    clickBalance = data.click_balance_history[lastKey] || 0;
                }

                // 2. –ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥
                let passiveIncomeEvents = [];
                if (data.boosts && data.boosts.passive_income) {
                    for (const card of ["card1", "card2", "card3"]) {
                        if (data.boosts.passive_income[card]) {
                            Object.entries(data.boosts.passive_income[card]).forEach(([level, timestamp]) => {
                                if (timestamp && Number.isInteger(timestamp)) {
                                    passiveIncomeEvents.push({
                                        timestamp,
                                        rate: boostConfig.passive_income[card].income
                                    });
                                }
                            });
                        }
                    }
                }
                passiveIncomeEvents.sort((a, b) => a.timestamp - b.timestamp);

                let totalPassiveIncome = 0;
                const loginTimestamps = data.login_history
                    ? Object.keys(data.login_history)
                          .filter(t => data.login_history[t] === 1)
                          .map(Number)
                          .sort()
                    : [];
                const now = Date.now();
                const maxSeconds = PASSIVE_INCOME_MAX_HOURS * 3600;

                for (let i = 0; i < loginTimestamps.length; i++) {
                    const loginTime = loginTimestamps[i];
                    const nextTime = i + 1 < loginTimestamps.length ? loginTimestamps[i + 1] : now;
                    let sessionDuration = Math.min((nextTime - loginTime) / 1000, maxSeconds);

                    const sessionEvents = passiveIncomeEvents
                        .filter(e => loginTime <= e.timestamp && e.timestamp <= nextTime)
                        .concat([{ timestamp: nextTime, rate: 0 }])
                        .sort((a, b) => a.timestamp - b.timestamp);

                    let currentRate = 0;
                    let lastTime = loginTime;
                    for (const event of sessionEvents) {
                        const duration = Math.min((event.timestamp - lastTime) / 1000, sessionDuration);
                        if (duration > 0) {
                            totalPassiveIncome += currentRate * duration;
                            sessionDuration -= duration;
                        }
                        currentRate += event.rate;
                        lastTime = event.timestamp;
                    }
                }

                // 3. –ó–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –ø–æ–∫—É–ø–∫–∏
                let totalSpent = 0;
                if (data.boosts) {
                    for (const boostType of ["multiply_per_click", "energy_limit", "recharge_energy"]) {
                        if (data.boosts[boostType]) {
                            Object.keys(data.boosts[boostType]).forEach(level => {
                                const lvl = parseInt(level);
                                if (lvl > 0) {
                                    totalSpent += boostConfig[boostType].cost(lvl);
                                }
                            });
                        }
                    }
                    if (data.boosts.passive_income) {
                        for (const card of ["card1", "card2", "card3"]) {
                            if (data.boosts.passive_income[card]) {
                                Object.keys(data.boosts.passive_income[card]).forEach(level => {
                                    const lvl = parseInt(level);
                                    if (lvl > 0) {
                                        totalSpent += boostConfig.passive_income[card].cost(lvl);
                                    }
                                });
                            }
                        }
                    }
                }

                const realBalance = clickBalance + totalPassiveIncome - totalSpent;
                console.log(Real balance: clicks=${clickBalance}, passive=${totalPassiveIncome}, spent=${totalSpent}, realBalance=${realBalance});
                return realBalance;
            } catch (error) {
                console.error("Error calculating real balance: ", error.message);
                return 0;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
        async function syncBalance() {
            const realBalance = await calculateRealBalance();
            balance = realBalance;
            localStorage.setItem(balance_${userId}, balance);
            console.log(Balance synced: balance=${balance});
            updateUI();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
        function updateUI() {
            document.getElementById("balance").innerText = Math.floor(balance);
            document.getElementById("energy").innerText = Energy: ${energy}/${maxEnergy};
            document.getElementById("energy-fill").style.width = ${(energy / maxEnergy) * 100}%;

            document.querySelector(".level-multiply-per-click").innerText = clickPower;
            document.querySelector(".cost-multiply-per-click").innerText = boostConfig.multiply_per_click.cost(clickPower);
            document.querySelector(".level-energy-limit").innerText = maxEnergy / 100;
            document.querySelector(".cost-energy-limit").innerText = boostConfig.energy_limit.cost(maxEnergy / 100);
            document.querySelector(".level-recharge-energy").innerText = rechargeRate;
            document.querySelector(".cost-recharge-energy").innerText = boostConfig.recharge_energy.cost(rechargeRate);
            document.querySelector(".level-passive-card1").innerText = passiveIncome.card1;
            document.querySelector(".cost-passive-card1").innerText = boostConfig.passive_income.card1.cost(passiveIncome.card1 + 1);
            document.querySelector(".level-passive-card2").innerText = passiveIncome.card2;
            document.querySelector(".cost-passive-card2").innerText = boostConfig.passive_income.card2.cost(passiveIncome.card2 + 1);
            document.querySelector(".level-passive-card3").innerText = passiveIncome.card3;
            document.querySelector(".cost-passive-card3").innerText = boostConfig.passive_income.card3.cost(passiveIncome.card3 + 1);
        }

        // –ü–æ–∫—É–ø–∫–∞ –±—É—Å—Ç–∞
        function buyBoost(type, path, cost, updateFn) {
            console.log(Buy attempt: balance=${balance}, cost=${cost});
            if (balance >= cost) {
                onValue(ref(db, users/${userId}/click_balance_history), snapshot => {
                    let calculatedBalance = 0;
                    if (snapshot.exists()) {
                        const lastKey = Object.keys(snapshot.val()).sort().pop();
                        calculatedBalance = snapshot.val()[lastKey] || 0;
                    }
                    if (calculatedBalance < cost) {
                        console.error(Invalid balance: client=${balance}, server=${calculatedBalance});
                        alert("Invalid balance. Please contact support.");
                        return;
                    }
                    balance -= cost;
                    localStorage.setItem(balance_${userId}, balance);
                    updateFn();
                    const now = Date.now();
                    const level = getNextLevel(path);
                    const timeValue = firstClickTime === 0 ? now : now - firstClickTime;
                    if (firstClickTime === 0) firstClickTime = now;
                    set(ref(db, users/${userId}/boosts/${path}/${level}), timeValue)
                        .then(() => {
                            console.log(Boost purchased: type=${type}, level=${level}, cost=${cost}, time=${timeValue});
                            saveClickHistory(now);
                            saveData().then(updateUI);
                        })
                        .catch(error => {
                            console.error(`Error saving boost ${type}: `, error.message);
                            alert(Failed to save boost: ${error.message});
                        });
                }, { onlyOnce: true });
            } else {
                console.log(Not enough coins: balance=${balance}, cost=${cost});
                alert("Not enough coins!");
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è –±—É—Å—Ç–∞
        function getNextLevel(path) {
            if (path === "multiply_per_click") return clickPower + 1;
            if (path === "energy_limit") return maxEnergy / 100 + 1;
            if (path === "recharge_energy") return rechargeRate + 1;
            if (path === "passive_income/card1") return passiveIncome.card1 + 1;
            if (path === "passive_income/card2") return passiveIncome.card2 + 1;
            if (path === "passive_income/card3") return passiveIncome.card3 + 1;
            return 1;
        }

        // –ü—Ä–∏–≤—è–∑–∫–∞ –∫–Ω–æ–ø–æ–∫ –±—É—Å—Ç–æ–≤
        document.querySelector(".boost-multiply-per-click").addEventListener("click", () => {
            const cost = boostConfig.multiply_per_click.cost(clickPower);
            buyBoost("multiply_per_click", "multiply_per_click", cost, () => { clickPower += 1; });
        });
        document.querySelector(".boost-energy-limit").addEventListener("click", () => {
            const cost = boostConfig.energy_limit.cost(maxEnergy / 100);
            buyBoost("energy_limit", "energy_limit", cost, () => { maxEnergy += 100; });
        });
        document.querySelector(".boost-recharge-energy").addEventListener("click", () => {
            const cost = boostConfig.recharge_energy.cost(rechargeRate);
            buyBoost("recharge_energy", "recharge_energy", cost, () => { rechargeRate += 0.5; });
        });
        document.querySelector(".boost-passive-card1").addEventListener("click", () => {
            const cost = boostConfig.passive_income.card1.cost(passiveIncome.card1 + 1);
            buyBoost("passive_income/card1", "passive_income/card1", cost, () => { passiveIncome.card1 += 1; });
        });
        document.querySelector(".boost-passive-card2").addEventListener("click", () => {
            const cost = boostConfig.passive_income.card2.cost(passiveIncome.card2 + 1);
            buyBoost("passive_income/card2", "passive_income/card2", cost, () => { passiveIncome.card2 += 1; });
        });
        document.querySelector(".boost-passive-card3").addEventListener("click", () => {
            const cost = boostConfig.passive_income.card3.cost(passiveIncome.card3 + 1);
            buyBoost("passive_income/card3", "passive_income/card3", cost, () => { passiveIncome.card3 += 1; });
        });

        // –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –¥—Ä—É–≥–∞
        document.querySelector(".invite-friend").addEventListener("click", () => {
            try {
                const inviteLink = https://t.me/your_bot?start=${encodeURIComponent(userId)};
                const shareUrl = https://t.me/share/url?url=${encodeURIComponent(inviteLink)}&text=${encodeURIComponent("Join my game!")};
                tg.openTelegramLink(shareUrl);
            } catch (error) {
                console.error("Error generating invite link: ", error.message);
                alert("Failed to generate invite link. Please try again.");
            }
        });

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–ª–∏–∫–æ–≤ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ
        tg.onEvent('mainButtonClicked', () => {
            saveClickHistory(Date.now());
            tg.close();
        });

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –≤–∫–ª–∞–¥–∫–∞–º
        document.querySelectorAll(".tab").forEach(tab => {
            tab.addEventListener("click", () => {
                const tabIndex = parseInt(tab.getAttribute("data-tab"));
                document.querySelectorAll(".content").forEach((content, index) => {
                    content.style.display = index === tabIndex - 1 ? "block" : "none";
                });
                document.querySelectorAll(".tab").forEach((t, index) => {
                    t.classList.toggle("active", index === tabIndex - 1);
                });
            });
        });
    </script>
</body>
</html>
